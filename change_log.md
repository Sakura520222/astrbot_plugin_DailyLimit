### v2.7.6 (2025-11-20)

#### 🔧 代码质量优化
- **Web服务器stop函数重构** - 将59行的长函数重构为5个单一职责的子函数，显著提升代码可读性和可维护性
- **函数职责分离** - 将stop函数拆分为`_stop_server_instance`、`_wait_for_thread_termination`、`_release_port`、`_cleanup_resources`、`_handle_stop_error`等子函数
- **代码复杂度降低** - 主函数从59行减少到15行，每个子函数都有明确的中文注释说明
- **错误处理优化** - 统一错误处理机制，提高代码健壮性

### v2.7.5 (2025-11-19)

#### 🐛 Bug修复
- **修复AiocqhttpMessageEvent对象方法不存在错误** - 解决了`AttributeError: 'AiocqhttpMessageEvent' object has no attribute 'get_group_name'`错误
- **方法调用优化** - 将`event.get_group_name()`替换为使用群组ID显示群组名称，确保代码兼容性
- **错误处理增强** - 改进群组名称获取逻辑，避免因方法不存在导致的插件崩溃

### v2.7.4 (2025-11-14)

#### 🛠️ 插件重载稳定性增强
- **Web服务器完全停止机制** - 增强了插件terminate方法，确保Web管理服务在插件重载时能完全停止并释放所有资源
- **端口即时释放功能** - 实现了端口强制释放机制，解决插件重载后端口仍被占用导致无法重启的问题
- **资源清理优化** - 改进了Web服务器的资源清理流程，包括线程管理和socket资源释放
- **异常处理完善** - 增强了停止过程中的异常处理，确保即使出现错误也能最大程度释放资源
- **日志记录增强** - 添加了详细的停止和资源释放过程日志，便于问题诊断

### v2.7.3 (2025-11-11)

#### 📈 趋势分析功能
- **多周期趋势分析** - 新增日、周、月三种时间维度的使用趋势分析
- **多指标统计** - 支持用户活跃度、使用频率、使用量分布等多维度指标
- **Web界面集成** - 在Web管理界面中集成趋势分析图表，支持Chart.js可视化
- **API接口支持** - 提供`/api/trends`接口，支持不同时间周期的趋势数据查询
- **认证机制** - 趋势分析API受密码保护，确保数据安全访问
- **错误处理** - 完善的参数验证和异常处理机制

### v2.7.2 (2025-11-09)

#### 🔧 代码质量优化
- **函数重构优化** - 将`_execute_abuse_detection_pipeline`函数（51行）重构为两个职责单一的小函数
- **提高可读性** - 通过函数拆分显著提升代码可读性和可维护性
- **模块化设计** - 将异常检测流水线分解为`_execute_abuse_detection_pipeline`和`_run_abuse_detection_flow`两个函数
- **错误处理优化** - 改进异常处理机制，确保检测过程异常时返回安全结果

### v2.7.1 (2025-11-09)

#### 🛡️ 防刷功能
- **智能防刷机制** - 增强防刷检测功能，支持快速请求检测和连续请求异常检测
- **自动限制机制** - 检测到异常行为时自动限制用户，防止恶意刷屏
- **管理员通知** - 防刷限制触发时自动向管理员发送通知，便于及时处理
- **限制时长配置** - 支持自定义防刷限制时长，灵活应对不同场景
- **防重复通知** - 新增防重复通知功能，避免同一用户重复触发限制时重复发送提醒消息

### v2.7.0 (2025-11-08)

#### 🔔 版本检查功能
- **自动更新检测** - 新增定时版本检查功能，自动检测插件新版本
- **智能通知机制** - 检测到新版本时自动向管理员发送通知消息
- **重复通知控制** - 避免骚扰
- **灵活配置选项** - 可自定义检查间隔、管理员列表、通知消息模板等
- **手动检查命令** - 新增`/limit checkupdate`命令，支持管理员手动触发版本检查

### v2.6.9 (2025-11-07)

#### 🔧 错误处理机制增强
- **统一错误处理** - 实现统一的错误处理机制，减少重复的异常处理代码
- **安全执行函数** - 新增`_safe_execute`函数，提供安全的函数执行环境
- **错误上下文追踪** - 改进错误日志记录，包含详细的错误上下文信息
- **Redis连接验证** - 增强Redis连接状态的验证机制
- **配置结构验证** - 添加配置文件的完整性验证

#### 🏗️ 代码质量提升
- **函数职责分离** - 将大型函数拆分为多个职责单一的小函数
- **代码复用性** - 新增通用辅助函数，提高代码复用率
- **可维护性** - 通过模块化设计提升代码的可维护性和可测试性

### v2.6.8 (2025-11-06)

#### 🔧 代码重构与优化
- **重构长函数，拆分为更小的职责单一的函数**
- **优化错误处理机制，减少冗余代码**
- **改进日志记录，减少重复的日志语句**

### v2.6.7 (2025-11-06)

#### ⏰ 自定义重置时间功能
- **灵活重置时间配置** - 支持自定义每日使用次数重置时间，不再局限于凌晨0点
- **24小时制时间格式** - 支持HH:MM格式的时间设置，如06:00、12:30、23:59等
- **配置验证机制** - 自动验证时间格式有效性，无效格式自动使用默认值并记录错误日志
- **管理员命令支持** - 新增/limit resettime系列命令，支持查看、设置和重置重置时间配置

#### 🔧 技术实现优化
- **硬编码消除** - 将所有硬编码的重置时间计算逻辑替换为动态配置驱动
- **错误处理增强** - 添加完整的配置验证和错误处理机制，确保系统稳定性
- **代码可维护性提升** - 通过统一的重置时间计算方法，简化代码逻辑

### v2.6.6 (2025-11-06)

#### 🔧 代码重构与优化
- **函数拆分重构** - 对核心复杂函数进行拆分，显著降低代码复杂度，提升可维护性
- **代码质量提升** - 重构了`_load_limits_from_config`、`_update_usage_stats`、`_setup_routes`、`_get_users_data`等关键函数
- **代码复杂度降低** - 通过函数拆分和职责分离，大幅降低代码复杂度，提高可读性

#### 🏗️ 架构改进
- **模块化设计** - 将大型函数拆分为多个职责单一的小函数，便于测试和维护
- **代码复用性增强** - 新增的辅助函数可以在其他模块中复用
- **错误处理优化** - 改进了异常处理机制，提升系统稳定性

### v2.6.5 (2025-11-06)

#### 🔧 配置格式优化
- **文本格式配置支持** - 将群组限制、用户限制、群组模式设置、时间段限制等配置项从JSON数组格式改为更易读的文本格式
- **配置管理优化** - 支持在Web管理界面中直接编辑文本格式的配置，提升配置管理效率
- **向后兼容** - 保持与旧版配置格式的兼容性，自动处理格式转换

#### 💻 Web界面改进
- **配置显示优化** - 更新Web管理界面中的配置信息显示，正确解析和显示文本格式的配置项数量
- **用户体验提升** - 优化配置编辑界面的交互体验，支持更直观的配置管理

### v2.6.0 (2025-11-03)

#### 🔤 /limit_status命令自定义消息功能
- **全面自定义状态消息** - 支持为/limit_status命令在不同场景下配置完全自定义的返回消息
- **多场景支持** - 支持私聊、群组共享模式、群组独立模式、豁免用户、时间段限制等五种场景的独立配置
- **丰富变量支持** - 支持使用{usage}、{limit}、{progress_bar}、{reset_time}、{limit_type}、{group_context}等变量
- **智能模板处理** - 自动处理模板变量错误，确保消息格式正确

#### 🔧 管理员命令扩展
| 命令 | 功能 | 示例 |
|------|------|------|
| `/limit messages list` | 查看所有可自定义的消息类型 | `/limit messages list` |
| `/limit messages set <类型> <消息>` | 设置特定类型的自定义消息 | `/limit messages set limit_status_private 您的使用状态：{usage}/{limit} {progress_bar}` |
| `/limit messages reset <类型>` | 重置指定类型的消息为默认 | `/limit messages reset limit_status_private` |
| `/limit messages reset_all` | 重置所有消息为默认 | `/limit messages reset_all` |

#### 💡 使用说明
- **消息类型**：支持 `zero_usage_message`、`zero_usage_group_shared_message`、`zero_usage_group_individual_message`、`limit_status_private_message`、`limit_status_group_shared_message`、`limit_status_group_individual_message`、`limit_status_exempt_message`、`limit_status_time_period_message`
- **变量支持**：不同消息类型支持不同的变量组合，具体可通过/limit messages list命令查看
- **默认消息**：如果未配置自定义消息，将使用系统默认的优化消息

### v2.5.3 (2025-11-03)

#### 🔤 自定义提醒消息功能
- **自定义零使用次数提醒** - 支持为不同场景配置当用户使用次数为0时的提醒消息
- **多场景支持** - 支持私聊、群组共享模式、群组独立模式三种场景的独立配置
- **管理员命令支持** - 新增/limit custom_messages系列命令用于管理自定义消息

#### 🔧 管理员命令扩展
| 命令 | 功能 | 示例 |
|------|------|------|
| `/limit custom_messages get` | 查看当前自定义消息配置 | `/limit custom_messages get` |
| `/limit custom_messages set <类型> <消息>` | 设置特定类型的自定义消息 | `/limit custom_messages set private 今日次数已用完` |
| `/limit custom_messages reset` | 重置为默认消息 | `/limit custom_messages reset` |

#### 💡 使用说明
- **消息类型**：支持 `private`（私聊）、`group_shared`（群组共享模式）、`group_individual`（群组独立模式）
- **消息内容**：支持使用变量如 `{user_name}`（用户名）、`{group_name}`（群组名）
- **默认消息**：如果未配置自定义消息，将使用系统默认的提醒消息

### v2.5.2 (2025-11-03)

- **端口占用自动检测** - Web服务器启动前自动检测默认端口是否被占用
- **智能端口切换** - 当默认端口被占用时，自动在100个端口范围内查找可用端口
- **随机端口备用** - 如果指定范围内没有可用端口，会随机尝试10个端口作为备用
- **配置自动保存** - 自动将新端口保存到配置文件，下次启动时使用新端口
- **控制台实时输出** - 在控制台显示详细的端口切换信息，便于管理员监控

### v2.5.1 (2025-11-02)

#### 🐛 Bug修复
- **修复Web管理界面无法正常终止问题** - 解决了v2.4.4版本中存在的Web服务器无法正常终止或重启的bug
- **优化资源释放机制** - 改进了插件重载或终止时的资源清理流程，避免端口占用和内存泄漏
- **增强稳定性** - 提升了Web服务器在线程管理和生命周期控制方面的稳定性

#### ⚡ 性能优化
- **响应速度提升** - 优化了Web管理界面的数据加载和渲染性能
- **内存使用优化** - 减少了不必要的内存占用，提升了整体运行效率

#### 🔧 其他改进
- **代码重构** - 对部分核心代码进行了重构，提高了代码质量和可维护性

### v2.5.0 (2025-11-02)

#### 🔐 Web管理界面密码保护功能
- **密码访问控制**：为Web管理界面添加完整的密码验证系统
- **会话管理**：支持用户登录状态保持，提供安全的会话管理
- **登录界面**：新增精美的樱花主题登录页面，支持错误提示
- **登出功能**：在管理界面添加登出按钮，支持安全退出
- **认证中间件**：所有API路由均受密码保护，防止未授权访问
- **灵活配置**：支持通过配置文件自定义访问密码，默认密码为"limit"
- **禁用选项**：密码字段留空即可禁用密码验证功能

### v2.4.5 (2025-11-01)

#### 🌐 Web管理界面重构优化
- **单页面布局**：移除标签页结构，所有信息一目了然
- **状态直观图**：新增环形图表展示用户使用率分布
- **实时状态监控**：添加正常/警告/危险状态指示
- **自动刷新**：每30秒自动更新数据
- **手动刷新按钮**：带旋转动画效果
- **错误处理系统**：优雅的错误提示机制
- **信息摘要**：每个数据区域顶部显示统计摘要
- **配置美化**：配置信息以卡片形式展示
- **状态概览**：显示正常/警告/危险状态的用户和群组数量统计

### v2.4.4 (2025-11-01)
- ✅ **自定义域名配置功能** - 支持在配置文件中添加自定义绑定的域名
- ✅ **域名查看管理员指令** - 新增/limit domain命令，快速查看域名配置和访问地址
- ✅ **智能访问链接生成** - 根据域名配置自动生成合适的访问链接格式
- ✅ **Web管理界面优化** - 支持通过自定义域名访问Web管理界面
- ⚠️ **Web功能开发测试阶段** - Web管理界面当前处于开发测试阶段，功能可能不完整，请谨慎使用


### v2.4.3 (2025-10-22)
- ✅ **全面优化/limit_status指令返回内容** - 大幅改进状态显示格式和用户体验
- ✅ **新增时间段限制状态显示** - 显示当前时间段限制、已使用次数和剩余次数
- ✅ **添加百分比进度条** - 为今日使用状态和时间段使用状态添加📈进度条显示
- ✅ **完善使用建议和提示信息** - 基于剩余次数提供分级提示和实用建议

### v2.4.2 (2025-10-21)
- ✅ **修复豁免用户状态显示问题** - 修复豁免用户在群组中发送/limit_status指令时返回错误消息的问题
- ✅ **优化状态显示逻辑** - 确保豁免用户在任何模式下都能正确显示个人豁免状态

### v2.4 & 2.4.1 (2025-10-20)
- ✅ **自定义忽略模式功能** - 支持用户自定义需要忽略处理的消息前缀
- ✅ **动态配置管理** - 支持通过配置文件或管理员命令动态管理忽略模式
- ✅ **向后兼容设计** - 默认保持与原有硬编码逻辑的兼容性
- ✅ **忽略模式管理命令** - 新增/limit skip_patterns系列命令

### v2.3 (2025-10-18)
- ✅ **时间段限制功能** - 支持按时间段设置不同的调用限制
- ✅ **时间段优先级** - 时间段限制优先级最高
- ✅ **时间段管理命令** - 新增/limit timeperiod系列命令

### v2.2 (2025-10-17)
- ✅ **群组独立模式** - 支持群组内成员独立使用次数
- ✅ **模式切换配置** - 支持为特定群组单独配置使用模式

### v2.1 (2025-10-17)
- ✅ **使用记录功能** - 自动记录每次调用，支持历史查询
- ✅ **多维度统计分析** - 提供用户、群组、全局等多维度分析

### v2.0 (2025-10-16)
- ✅ **群组共享机制** - 群组成员共享使用次数
- ✅ **智能计数切换** - 自动识别消息类型
